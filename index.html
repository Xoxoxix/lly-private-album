<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLY</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .login-container {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            padding: 50px 40px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.6);
            text-align: center;
            width: 100%;
            max-width: 450px;
            border: 1px solid #333;
        }
        .album-container {
            display: none;
            width: 100%;
            max-width: 1400px;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
            min-height: 80vh;
        }
        .logo { font-size: 48px; margin-bottom: 20px; }
        .title { color: #e0e0e0; margin-bottom: 10px; font-size: 28px; }
        .subtitle { color: #aaa; margin-bottom: 30px; font-size: 16px; }.download.btn{
    background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
    color: #e0e0e0;
    border: 1px solid #555;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.3s;
}
.download-btn:hover { background: linear-gradient(135deg, #5a5a5a 0%, #3a3a3a 100%); }
.logout-btn {
    background: linear-gradient(135deg, #ff4757 0%, #cc3745 100%);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.3s;
}
.upload-section {
    background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
    padding: 25px;
    border-radius: 12px;
    margin-bottom: 30px;
    border: 2px dashed #444;
}
.upload-title { color: #e0e0e0; margin-bottom: 20px; font-size: 20px; }
.upload-controls { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
.file-input {
    flex: 1;
    min-width: 200px;
    padding: 10px;
    border: 1px solid #555;
    border-radius: 6px;
    background: #2a2a2a;
    color: #e0e0e0;
}
.upload-btn {
    background: linear-gradient(135deg, #4a4a4a 0%, #2a2a2a 100%);
    color: #e0e0e0;
    border: 1px solid #555;
    padding: 10px 24px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.3s;
}
.upload-btn:hover { background: linear-gradient(135deg, #5a5a5a 0%, #3a3a3a 100%); }
.file-type-buttons { display: flex; gap: 8px; margin: 15px 0; flex-wrap: wrap; }
.file-type-btn {
    padding: 6px 14px;
    border: 1px solid #555;
    border-radius: 6px;
    background: #2a2a2a;
    color: #b0b0b0;
    cursor: pointer;
    font-size: 13px;
    transition: all 0.3s;
}
.file-type-btn.active { background: #444; color: #e0e0e0; border-color: #667eea; }
.upload-note { margin-top: 15px; color: #888; font-size: 13px; }
.media-gallery {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
    margin-top: 20px;
}
.media-item {
    position: relative;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 6px 20px rgba(0,0,0,0.4);
    transition: all 0.3s ease;
    background: #1a1a1a;
    border: 1px solid #333;
}
.media-item:hover { transform: translateY(-5px); box-shadow: 0 12px 30px rgba(0,0,0,0.6); border-color: #555; }
.media-item img, .media-item video { width: 100%; height: 240px; object-fit: cover; display: block; }
.media-item video { background: #000; }
.media-badge {
    position: absolute;
    top: 10px;
    right: 10px;
    background: rgba(0,0,0,0.85);
    color: #e0e0e0;
    padding: 4px 8px;
    border-radius: 6px;
    font-size: 11px;
    z-index: 2;
    border: 1px solid #444;
    font-weight: 500;
}
.media-protection {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.88);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: #e0e0e0;
    font-size: 14px;
    backdrop-filter: blur(4px);
    padding: 20px;
    text-align: center;
}
.protection-icon { font-size: 28px; margin-bottom: 12px; opacity: 0.7; }
.protection-text { margin-bottom: 15px; line-height: 1.4; color: #aaa; font-size: 13px; }
.unlock-btn {
    background: rgba(255, 255, 255, 0.08);
    color: #e0e0e0;
    border: 1px solid rgba(255, 255, 255, 0.2);
    padding: 6px 16px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
    transition: all 0.2s;
}
.unlock-btn:hover { background: rgba(255, 255, 255, 0.12); border-color: rgba(255, 255, 255, 0.3); }
.media-item.unlocked .media-protection { display: none; }
.media-item.unlocked { cursor: pointer; }
.media-info { padding: 12px; background: #1a1a1a; border-top: 1px solid #2a2a2a; }
.media-type { color: #777; font-size: 10px; text-transform: uppercase; font-weight: 600; margin-bottom: 4px; letter-spacing: 0.5px; }
.media-date { color: #555; font-size: 11px; margin-top: 4px; }
.empty-state { grid-column: 1 / -1; text-align: center; padding: 50px 20px; color: #666; background: #1a1a1a; border-radius: 10px; border: 1px dashed #333; }
.empty-icon { font-size: 48px; margin-bottom: 15px; opacity: 0.25; }
.modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: #1a1a1a;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            max-width: 350px;
            width: 90%;
            border: 1px solid #333;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .modal-buttons { display: flex; gap: 10px; margin-top: 20px; justify-content: center; }
        .modal-btn { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; transition: all 0.2s; }
        .modal-confirm { background: #2a2a2a; color: #e0e0e0; border: 1px solid #444; }
        .modal-confirm:hover { background: #333; }
        .modal-cancel { background: #333; color: #aaa; border: 1px solid #555; }
        .modal-cancel:hover { background: #3a3a3a; }
        .media-item:not(.unlocked) { -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; -webkit-touch-callout: none; }
        .media-item:not(.unlocked) img, .media-item:not(.unlocked) video { pointer-events: none; -webkit-touch-callout: none; -webkit-user-drag: none; }
        @media (max-width: 768px) {
            .login-container { padding: 30px 20px; }
            .album-container { padding: 20px 15px; }
            .upload-controls { flex-direction: column; }
            .file-input { width: 100%; }
            .media-gallery { grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; }
            .header-title { font-size: 24px; }
            .user-controls { flex-direction: column; gap: 8px; }
            .modal-content { padding: 25px 20px; }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in { animation: fadeIn 0.3s ease-out; }
    </style>
</head>
<body>
    <div class="login-container" id="loginPage">
        <div class="logo">🔒</div>
        <h1 class="title">秘密基地</h1>
        <p class="subtitle">支持照片、Live图、视频的私密存储</p>
        <input type="password" class="password-input" id="password" placeholder="请输入访问密码">
        <button class="login-btn" onclick="checkPassword()">进入相册</button>
        <p style="margin-top: 25px; color: #666; font-size: 14px;">📸 支持图片 · 🎞️ 支持Live图 · 🎥 支持视频</p>
    </div>
    
    <div class="album-container" id="albumPage">
        <div class="header-bar">
            <h1 class="header-title">📁 秘密基地</h1>
            <div class="user-controls">
                <button class="download-btn" onclick="enableAllDownloads()">一键解锁下载</button>
                <button class="logout-btn" onclick="logout()">退出登录</button>
            </div>
        </div>
        
        <div class="upload-section">
            <h3 class="upload-title">📤 上传文件</h3>
            <div class="file-type-buttons">
                <button class="file-type-btn active" onclick="setFileType('all')">全部类型</button>
                <button class="file-type-btn" onclick="setFileType('image')">图片</button>
                <button class="file-type-btn" onclick="setFileType('video')">视频</button>
                <button class="file-type-btn" onclick="setFileType('live')">Live图</button>
            </div>
            <div class="upload-controls">
                <input type="file" class="file-input" id="fileInput" accept="image/*,video/*" multiple>
                <button class="upload-btn" onclick="uploadMedia()">上传文件</button>
            </div>
            <p class="upload-note">💡 支持：JPG、PNG图片 | MP4、MOV视频 | Live图（MOV/HEIC格式）</p>
        </div>
        
        <div class="media-gallery" id="mediaGallery">
            <div class="empty-state">
                <div class="empty-icon">🖼️</div>
                <h3>还没有内容</h3>
                <p>上传第一个文件开始你的秘密基地吧！</p>
            </div>
        </div>
    </div>
    
    <div class="modal" id="unlockModal">
        <div class="modal-content">
            <div style="font-size: 32px; margin-bottom: 15px; opacity: 0.8;">🔓</div>
            <h3 style="color: #e0e0e0; margin-bottom: 10px;">解锁下载权限</h3>
            <p style="margin: 15px 0; color: #aaa; font-size: 13px;">请输入下载密码解锁此文件的保存功能</p>
            <input type="password" class="password-input" id="downloadPassword" placeholder="请输入下载密码" style="background: #2a2a2a; border-color: #444; color: #e0e0e0;">
            <div class="modal-buttons">
                <button class="modal-btn modal-confirm" onclick="verifyDownloadPassword()">确认解锁</button>
                <button class="modal-btn modal-cancel" onclick="closeUnlockModal()">取消</button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="bulkUnlockModal">
        <div class="modal-content">
            <div style="font-size: 32px; margin-bottom: 15px; opacity: 0.8;">🔑</div>
            <h3 style="color: #e0e0e0; margin-bottom: 10px;">一键解锁所有文件</h3>
            <p style="margin: 15px 0; color: #aaa; font-size: 13px;">请输入下载密码解锁所有文件的保存功能</p>
            <input type="password" class="password-input" id="bulkDownloadPassword" placeholder="请输入下载密码" style="background: #2a2a2a; border-color: #444; color: #e0e0e0;">
            <div class="modal-buttons">
                <button class="modal-btn modal-confirm" onclick="verifyBulkDownloadPassword()">确认解锁全部</button>
                <button class="modal-btn modal-cancel" onclick="closeBulkUnlockModal()">取消</button>
            </div>
        </div>
    </div>

<script>
    const ACCESS_PASSWORD = "LLY123";
    const DOWNLOAD_PASSWORD = "20031122";
    const IMGBB_API_KEY = "3dae31037fd4b1514369a2d9b8e969cd";
    
    let currentMediaIndex = -1;
    let unlockStates = [];
    let currentFileType = 'all';
    
    function setFileType(type) {
        currentFileType = type;
        const fileInput = document.getElementById('fileInput');
        const buttons = document.querySelectorAll('.file-type-btn');
        buttons.forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        switch(type) {
            case 'image': fileInput.accept = 'image/*'; break;
            case 'video': fileInput.accept = 'video/*'; break;
            case 'live': fileInput.accept = '.mov,.heic,.live'; break;
            default: fileInput.accept = 'image/*,video/*';
        }
    }
    
    function getMediaType(file) {
        if (file.type.startsWith('image/')) {
            if (file.name.toLowerCase().includes('live') || file.type === 'image/heic' ||
                file.name.toLowerCase().endsWith('.heic') || file.name.toLowerCase().endsWith('.mov')) {
                return 'live';
            }
            return 'image';
        } else if (file.type.startsWith('video/')) {
            return 'video';
        }
        return 'unknown';
    }
    
    function getMediaTypeInfo(type) {
        switch(type) {
            case 'image': return { name: '图片', icon: '🖼️', badge: '图片' };
            case 'video': return { name: '视频', icon: '🎥', badge: '视频' };
            case 'live': return { name: 'Live图', icon: '🎞️', badge: 'Live' };
            default: return { name: '文件', icon: '📄', badge: '文件' };
        }
    }
function checkPassword() {
    const input = document.getElementById('password').value;
    if (input === ACCESS_PASSWORD) {
        document.getElementById('loginPage').style.display = 'none';
        document.getElementById('albumPage').style.display = 'block';
        loadMedia();
    } else {
        alert('❌ 密码错误！请检查后重试。');
        document.getElementById('password').value = '';
        document.getElementById('password').focus();
    }
}

function logout() {
    if (confirm('确定要退出登录吗？')) {
        document.getElementById('loginPage').style.display = 'flex';
        document.getElementById('albumPage').style.display = 'none';
        document.getElementById('password').value = '';
        unlockStates = [];
    }
}

async function uploadMedia() {
    const fileInput = document.getElementById('fileInput');
    const files = fileInput.files;
    const gallery = document.getElementById('mediaGallery');
    
    if (files.length === 0) {
        alert('📝 请先选择要上传的文件！');
        return;
    }
    
    if (gallery.querySelector('.empty-state')) gallery.innerHTML = '';
    
    let uploadedCount = 0;
    let skippedCount = 0;
    
    for (let file of files) {
        if (file.size > 30 * 1024 * 1024) {
            alert(`⚠️ 文件 "${file.name}" 超过30MB限制，已跳过。`);
            skippedCount++;
            continue;
        }
        
        try {
            const imageUrl = await uploadToImgBB(file);
            if (imageUrl) {
                createMediaItem(file, imageUrl);
                uploadedCount++;
                unlockStates.push(false);
                saveToLocal();
            }
        } catch (error) {
            alert(`❌ 文件 "${file.name}" 上传失败，已跳过。`);
            skippedCount++;
        }
    }
    
    if (uploadedCount > 0) {
        alert(`✅ 成功上传 ${uploadedCount} 个文件！${skippedCount > 0 ? '\n⚠️ ' + skippedCount + ' 个文件失败或跳过。' : ''}`);
    }
    
    fileInput.value = '';
}

async function uploadToImgBB(file) {
    const formData = new FormData();
    formData.append('image', file);
    const response = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, {
        method: 'POST', body: formData
    });
    const result = await response.json();
    if (result.success) return result.data.url;
    else throw new Error(result.error.message);
}

function createMediaItem(file, imageUrl) {
    const mediaType = getMediaType(file);
    const typeInfo = getMediaTypeInfo(mediaType);
    const gallery = document.getElementById('mediaGallery');
    const uploadDate = new Date().toLocaleDateString('zh-CN', {
        year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit'
    });
    
    let mediaContent = mediaType === 'video' ? 
        `<video controls><source src="${imageUrl}" type="${file.type}">不支持视频播放</video>` :
        `<img src="${imageUrl}" alt="${typeInfo.name}">`;
    
    const mediaItem = document.createElement('div');
    mediaItem.className = 'media-item fade-in';
    mediaItem.innerHTML = `
        ${mediaContent}
        <div class="media-badge">${typeInfo.badge}</div>
        <div class="media-protection">
            <div class="protection-icon">🔒</div>
            <div class="protection-text">此${typeInfo.name}受保护<br>需要密码才能解锁下载</div>
            <button class="unlock-btn" onclick="requestUnlock(${unlockStates.length})">解锁下载</button>
        </div>
        <div class="media-info">
            <div class="media-type">${typeInfo.icon} ${typeInfo.name}</div>
            <strong>${file.name}</strong>
            <div class="media-date">${uploadDate}</div>
        </div>
    `;
    gallery.appendChild(mediaItem);
}
function loadMedia() {
        const savedMedia = localStorage.getItem('privateMedia');
        const savedUnlockStates = localStorage.getItem('unlockStates');
        const gallery = document.getElementById('mediaGallery');
        if (savedUnlockStates) unlockStates = JSON.parse(savedUnlockStates);
        if (savedMedia && savedMedia !== '<div class="empty-state">...</div>') {
            gallery.innerHTML = savedMedia;
            const mediaItems = gallery.querySelectorAll('.media-item');
            mediaItems.forEach((item, index) => {
                if (unlockStates[index]) item.classList.add('unlocked');
            });
        }
    }
    
    function requestUnlock(index) {
        currentMediaIndex = index;
        document.getElementById('unlockModal').style.display = 'flex';
        document.getElementById('downloadPassword').value = '';
        document.getElementById('downloadPassword').focus();
    }
    
    function verifyDownloadPassword() {
        const input = document.getElementById('downloadPassword').value;
        if (input === DOWNLOAD_PASSWORD) {
            unlockSingleMedia(currentMediaIndex);
            closeUnlockModal();
            alert('🔓 解锁成功！现在可以保存此文件了。');
        } else {
            alert('❌ 下载密码错误！');
            document.getElementById('downloadPassword').value = '';
            document.getElementById('downloadPassword').focus();
        }
    }
    
    function unlockSingleMedia(index) {
        const mediaItems = document.querySelectorAll('.media-item');
        if (mediaItems[index]) {
            mediaItems[index].classList.add('unlocked');
            unlockStates[index] = true;
            saveToLocal();
        }
    }
    
    function enableAllDownloads() {
        document.getElementById('bulkUnlockModal').style.display = 'flex';
        document.getElementById('bulkDownloadPassword').value = '';
        document.getElementById('bulkDownloadPassword').focus();
    }
    
    function verifyBulkDownloadPassword() {
        const input = document.getElementById('bulkDownloadPassword').value;
        if (input === DOWNLOAD_PASSWORD) {
            const mediaItems = document.querySelectorAll('.media-item');
            mediaItems.forEach((item, index) => {
                item.classList.add('unlocked');
                unlockStates[index] = true;
            });
            closeBulkUnlockModal();
            saveToLocal();
            alert('🔓 所有文件已解锁！现在可以保存所有文件了。');
        } else {
            alert('❌ 下载密码错误！');
            document.getElementById('bulkDownloadPassword').value = '';
            document.getElementById('bulkDownloadPassword').focus();
        }
    }
    
    function closeUnlockModal() { document.getElementById('unlockModal').style.display = 'none'; }
    function closeBulkUnlockModal() { document.getElementById('bulkUnlockModal').style.display = 'none'; }
    function saveToLocal() {
        const gallery = document.getElementById('mediaGallery');
        localStorage.setItem('privateMedia', gallery.innerHTML);
        localStorage.setItem('unlockStates', JSON.stringify(unlockStates));
    }
    
    document.addEventListener('contextmenu', function(e) {
        const mediaItem = e.target.closest('.media-item');
        if (mediaItem && !mediaItem.classList.contains('unlocked')) {
            e.preventDefault();
            alert('🔒 此文件受保护，需要解锁后才能保存');
        }
    });
    
    document.getElementById('password').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') checkPassword();
    });
    
    window.addEventListener('load', function() {
        document.getElementById('password').focus();
    });
</script>
</body>
</html>
